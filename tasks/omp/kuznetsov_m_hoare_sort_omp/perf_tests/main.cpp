// Copyright 2024 Kuznetsov Mikhail
#include <gtest/gtest.h>
#include <omp.h>

#include <algorithm>
#include <vector>

#include "core/perf/include/perf.hpp"
#include "omp/kuznetsov_m_hoare_sort_omp/include/hoare_sort_omp.hpp"

using namespace kuznetsov_omp;

TEST(kuznetsov_m_hoare_sort_omp, test_pipeline_run) {
  std::vector inputArray {
      -668, -340, -335, 22, 682, -733, -113, 840, -579, 469, -51, 177, 662, -736, 158, -714, 141, 387, -624, 624,
      -883, -656, 340, -519, 754, -707, -523, -907, 431, -65, 56, 657, 503, -687, -75, 811, -977, -179, -170, -190,
      -252, 955, -520, 465, 988, 669, -346, 241, 419, 913, -767, 407, 107, 731, -183, 251, -941, -539, -582, 773,
      829, -387, 812, -334, 623, 320, -300, -569, -777, 560, 905, 584, 804, -603, 707, -190, -26, -48, 374, 26,
      709, -925, -335, -226, -825, -357, -219, 624, -129, 676, 633, -76, 92, 120, 166, -162, 885, -445, 836, 242,
      412, 996, 318, -730, 169, 514, 858, -77, -421, 645, 366, -956, -45, -742, 191, -783, -581, -584, -792, 809,
      518, 820, -144, 926, -867, 992, -978, -374, 415, -53, -817, 35, 916, -582, 827, -509, -301, 99, -779, 75,
      980, -929, 414, -571, -283, -116, 53, 408, -466, 279, -59, -48, -479, 401, -270, -811, -803, 910, -471, 569,
      -145, 157, 766, 576, -628, 787, -233, 859, 461, -345, -568, 624, 899, 161, -378, 792, 217, 341, -689, 708,
      371, -38, -645, -94, -993, -225, -955, -657, 957, 489, 95, 599, 222, 986, 624, -947, -467, 173, -523, 201,
      -49, -752, 139, 477, -934, -804, 290, -286, 831, 214, -877, -396, -868, 245, -449, -789, 993, -499, 726, 671,
      606, 229, -562, -912, 158, 582, 995, 675, 319, 715, 979, 236, -973, 853, -987, -244, 100, 74, -459, 341,
      -839, -878, -296, -309, 117, 575, -460, -312, 278, 357, 364, -436, -183, 111, 621, -734, 665, 786, 276, 28,
      741, -122, -871, 112, 857, 933, -26, 677, -127, 800, -603, 271, 276, 483, -849, -582, -579, 517, -259, 4,
      377, 679, 449, 502, 528, -418, -665, 739, -94, 560, -241, 271, 640, 606, -51, 201, 635, -967, -109, 762,
      -423, -342, -492, -673, 646, 905, 381, 421, -218, -688, 742, -302, -278, 367, -390, -523, 949, 99, -727, 980,
      -514, 558, 765, 531, 852, -658, 226, -266, 562, -40, 716, 963, -847, -311, 461, -188, 444, -615, -492, 464,
      14, 883, 852, 512, 659, -993, 424, 79, 523, 935, 422, 723, -266, 285, -193, -150, -473, -475, 537, -99,
      -922, 59, 315, -192, 678, 279, -859, -117, -936, -932, 851, 268, -237, 187, 860, -319, -530, 961, 111, -220,
      -20, -775, -600, 855, -225, 907, 112, -112, -208, -25, -312, 408, 626, -265, -268, 91, 584, -886, -395, -602,
      999, -982, -469, -547, -908, -390, 269, -706, -939, -784, 192, 976, 143, 20, -557, -786, -118, -259, 785, -297,
      -444, 533, 169, -707, 157, -940, 500, -590, 849, -709, -752, -535, -656, -269, 513, -417, 676, 190, 918, 307,
      459, 882, -134, 312, 688, -579, -245, -647, 963, 219, 785, -822, 678, -886, -443, 747, 119, -711, 28, 305,
      -176, -360, -584, 35, -630, -655, 281, -710, 116, -410, -658, 621, -171, -897, 427, 469, 303, 341, 361, 290,
      -410, 59, -345, 340, -102, 572, -951, -841, 588, -252, -864, -203, -789, -118, 378, 275, -259, -643, -552, -883,
      609, 212, 106, -143, 457, 717, 24, 657, 420, -264, -46, 546, 575, -98, -53, -497, 512, -726, 157, 995,
      -261, 83, -500, -400, 55, 775, 230, -74, 565, 773, 876, -243, 962, 535, -956, 695, 908, -206, 240, 424,
      54, 120, -188, 674, 484, 816, 58, -838, -876, -424, 425, -363, -533, -405, 281, 318, -403, 462, 82, 782,
      64, 22, 350, 250, -918, 390, 331, 713, -894, -925, 666, 809, -107, 460, -271, -82, -684, 83, -110, -456,
      611, 495, 889, -655, -396, 193, 224, -213, 127, 561, 50, 441, 46, -76, 221, 68, -139, -183, -671, -613,
      953, 657, -644, -656, -594, -652, -145, -903, -53, -877, 645, 646, -554, 487, -974, 456, 760, -625, 964, -505,
      133, -549, -438, 445, -856, -25, -941, -702, 945, -759, 870, -272, 981, 123, 836, 922, -546, -200, 836, -434,
      -237, 462, -681, 908, -781, 627, 755, 296, 590, -524, -83, 399, 621, 28, 118, -603, 386, -247, 199, -335,
      -74, -277, -98, -552, 797, 798, -245, 504, 269, -114, 409, 458, 867, -873, -25, -510, 110, -406, 481, 338,
      94, -681, 781, -791, 126, -602, 164, 345, 590, -651, 740, -139, -153, 488, -312, 436, 21, 513, 743, 350,
      -416, 965, 327, 574, -408, -450, -386, 795, -440, -514, -450, 68, 362, -205, -913, 694, 278, -29, -45, 430,
      -914, 669, 720, 44, -867, -940, 86, 431, -58, 31, -215, -6, 99, 430, 920, 400, -115, -81, 21, 753,
      -871, -961, -403, 432, 655, 665, -485, 37, 233, -784, 11, -498, 327, 721, 856, 578, 985, 747, 195, 41,
      -229, -259, -810, 208, -270, -238, 312, -188, 445, -213, -726, 151, 945, -404, 16, -699, -937, -912, 37, -815,
      -808, -646, 316, -229, -348, 264, -893, 676, -80, 695, -965, 70, 953, 639, 30, -346, -686, -568, -126, -562,
      298, 594, -859, 132, -575, 271, 910, -76, -70, 991, 556, -619, 795, -493, -21, 98, -270, 469, 614, -10,
      488, -647, -411, -934, -512, 533, 408, -302, 303, 264, 869, -856, 563, 848, 447, -771, 12, 264, -579, 282,
      805, -437, -237, -535, 818, -725, -864, -874, 488, 245, 764, -974, 363, 131, 245, 996, 233, 477, -168, 87,
      733, -96, -271, -207, 66, -621, 32, 311, -771, 910, -175, -212, 505, 991, -78, -146, -184, 372, 718, 200,
      -98, 356, -482, -963, 970, 811, 557, 277, -388, 4, -504, 976, 717, 366, -858, -411, -949, 605, 277, -539,
      700, -546, -992, 614, 925, -685, 388, -867, 508, -164, -759, 300, -614, 296, 714, -559, 617, 566, -177, -494,
      -312, -362, 872, 18, 157, -327, 210, -148, -753, 853, 129, 780, -580, 962, 792, -318, 191, 346, 274, -59,
      -384, -621, 394, 304, 524, -536, -4, 575, 405, 793, 652, 745, 223, 694, -947, 424, -444, -979, -125, -890,
      316, 809, -997, 147, -617, -776, 199, 197, -638, -686, -360, -668, 951, 819, 553, -50, -117, -500, -606, 551,
      -645, 749, -430, -981, 220, -900, -662, -138, -922, 532, -864, -391, -647, -941, 701, -500, -135, 637, -79, 757,
      -232, 734, -953, 284, 868, -881, -706, -553, -767, -231, -745, -979, 241, -244, 379, -658, 740, 250, 89, 489,
      -887, -5, -922, -944, 102, -385, -165, -80, 322, -858, -979, 995, 403, 503, 181, 35, -445, -268, 32, -238,
      -505, -77, 211, -267, 25, -349, 771, -120, 634, -234, 352, 42, -140, 297, -378, 896, -788, 21, 89, -871,
      -279, 4, 438, -680, 732, -234, -175, -917, -320, -559, -307, 761, 407, 945, -617, -537, 750, -611, 526, -296,
      -222, -983, 594, 45, -534, 199, -861, -806, -447, 893, 943, 371, -946, -155, -467, 837, -447, -393, -300, -717,
      -481, 120, 609, 130, 224, -11, 502, 414, -412, 480, -91, -205, -706, -909, 837, 539, -941, 890, 793, -205,
      -809, 494, -111, -224, 505, 312, -686, -438, 973, 129, 802, -954, 568, -721, 515, 862, -873, 748, 661, -180,
      -2, 455, -464, 90, 87, -792, 664, 849, -927, -347, -574, 853, -13, -723, 793, 782, 663, -641, 456, -662,
      -58, -746, -314, 163, 24, -691, -731, 608, -452, 407, 850, -886, 661, 990, 567, -258, 455, 184, -1, -985,
      -216, 93, -273, -718, 404, -659, -569, -522, -324, -435, 637, 720, -868, 427, 732, -751, 594, 493, -224, -349,
      608, 800, -494, 99, 165, 132, -242, 327, 24, 668, 161, 181, -925, 784, -83, 94, -189, 445, -576, 191,
      -806, -723, -677, -347, 256, -73, 251, -544, 87, -940, -310, -68, -166, 70, 672, 352, -10, 933, 929, 24,
      431, -284, 351, 452, 828, -575, 200, -281, -412, 33, 847, 128, 47, 504, 343, 36, -242, 380, -133, 962,
      -706, -323, -712, -84, 36, -348, 641, 983, -101, 193, 798, -374, 541, 508, 290, -627, 189, 492, 719, -789,
      723, 972, 933, 36, 577, 351, -899, -34, -730, -495, -974, 885, -692, -220, 825, -804, -590, -496, 928, -465,
      616, -557, -690, -102, 254, 329, -98, -247, 946, -998, 863, 740, 923, 458, 946, -612, -61, -502, -189, -16,
      969, 134, -580, 279, -669, -314, 685, -867, -964, 293, 565, 628, 234, 847, 502, -660, 882, 647, 137, 31,
      89, -133, -762, 906, 590, 840, -911, -5, 484, 330, 595, 214, -208, -688, -590, -120, -759, 527, 12, -43,
      88, 699, -64, 859, -750, 562, -634, -266, 877, 744, 1000, 628, 470, 662, -318, 638, -641, 451, -158, -754,
      -258, 795, 400, -199, -262, 150, -89, 950, 879, 983, -377, -863, -873, 956, 984, -7, -919, 433, 976, 886,
      -663, -805, 238, -469, -130, -86, 695, 826, 331, -10, 757, -937, -537, -279, -326, -291, -82, 815, 835, -834,
      376, 439, 663, 900, 609, 806, -30, 21, -384, 82, -595, -566, -695, 467, 683, 706, 592, 773, -221, -708,
      -384, 208, -819, 831, -348, -585, -393, 428, -648, 833, -817, 509, 961, -603, -624, 31, -796, 652, 406, -643,
      421, 211, 873, 167, -332, -579, -714, -695, -277, 683, -836, 430, 801, 121, 39, -498, 797, 69, 737, -942,
      773, -700, -156, 395, -498, 449, 990, -280, 2, -251, -141, -927, 966, 327, -792, -415, 174, 296, -263, -559,
      -704, -362, -853, 537, -876, -529, 110, -999, -182, -840, -414, -779, 398, -903, -333, 671, -356, 837, -325, -145,
      625, 818, 39, 105, 42, -334, -880, 237, -323, 274, -592, 727, 196, -394, -233, 633, -1, -986, 557, -763,
      -264, 806, -81, -516, 107, -452, -825, -822, 18, 143, -592, -496, 405, 299, 517, -938, -38, 663, 503, -851,
      214, -478, 382, -836, 83, 154, 237, -393, 967, -603, 153, -16, -261, -271, -585, 706, -270, 907, 208, -958,
      -301, -867, -741, 328, 658, 829, -147, 549, -647, -979, 154, 213, -742, -221, -838, -918, -678, -575, 957, -182,
      -867, 774, -730, 653, 139, -462, -367, -381, 364, -237, -509, -494, 562, 131, 580, 634, -756, -405, -757, 337,
      -364, -912, -670, 156, 683, 935, 377, -787, 185, -57, 872, -80, 486, -551, -5, -235, 884, 815, 730, 124,
      131, 114, -314, 754, -451, -500, 368, 981, -280, 236, 293, 265, -944, -733, -523, -483, 635, 864, -506, -686,
      -999, -936, -52, -116, -918, 249, 733, -403, 80, -296, -790, 866, -754, 618, 118, 771, -483, 510, -528, -226,
      524, 185, 812, -245, 395, -850, 588, 530, 465, -516, 373, 892, -5, 853, -131, 430, 789, 822, 123, -432,
      -191, 367, -139, 984, 400, 954, 199, -216, -869, 474, -70, 23, 758, 554, 135, -187, 326, 560, 589, -807,
      935, -584, -941, 623, -370, -901, 10, 501, -237, -690, 75, -362, 691, -384, -123, 174, -777, 665, -287, -534,
      -938, 917, 719, 90, 115, -668, 42, -722, -164, -264, 306, 942, 842, -47, 834, -372, 940, -44, 391, 814,
      -16, -863, -858, -982, 855, 227, -847, 712, 1, 319, 165, 721, 553, -996, -252, -844, 97, 363, -309, -743,
      577, -963, 301, -180, -923, 604, -193, -363, 899, -622, -849, 178, -2, 843, 1000, -894, -175, 280, -82, -915,
      -134, 387, 650, -464, -415, -267, -667, -633, 664, -217, 437, 806, 349, -877, 789, -681, 11, 186, 489, 603,
      299, 196, 134, -833, 983, 544, 105, -484, -677, -841, -343, 461, -29, -535, -602, 601, 131, -967, -730, 158,
      406, -276, -934, -111, -160, -713, 785, -93, 561, -908, -193, 835, -969, 876, 720, 117, -886, 396, -453, -78,
      102, -886, 699, 622, -90, 519, 489, -709, 431, -277, 561, -685, 203, 531, 556, 144, 297, 765, -144, -611,
      -364, 382, 300, -505, 583, -808, 558, 896, 410, -267, 251, -555, 604, 319, -398, 128, -743, 804, -37, 903,
      603, 697, 13, 272, -15, -164, -579, -430, 450, -689, -888, 755, -515, -730, 775, 132, 548, 619, -471, -736,
      -410, -643, -101, 822, 571, -615, -283, 977, 313, -648, -581, -996, -380, -881, -723, -5, -277, 170, 494, 818,
      -229, 251, -41, 934, -780, -161, 796, -235, 416, 525, -670, 2, 975, 404, -279, 999, 248, -573, 861, -343,
      -801, 931, 842, -768, 999, -906, -921, -591, -395, -249, 599, -517, 299, -344, 421, 843, 262, -425, 722, 571,
      -286, 902, 92, 835, 257, 999, 130, 1000, -482, 15, 355, -872, -686, 714, -700, 78, -220, 993, 112, -799,
      663, 494, 152, 597, 734, -710, 429, 131, 7, -939, -398, -383, 570, -279, 820, -488, -533, 921, -950, 571,
      590, -301, 877, 839, -471, 343, -197, -52, -831, -608, 668, -27, 502, -648, -435, 644, 387, -710, 76, 7,
      -675, -494, -640, 560, 612, 6, 707, 882, 277, 176, 688, -746, 341, 491, -34, -655, 462, 345, -813, 198,
      491, -662, 60, -138, -496, -360, -448, 147, -560, 765, 886, -21, 176, -11, -62, -43, -203, -125, -955, -684,
      198, -767, 16, -714, -370, -423, -333, 491, 201, 387, 482, -42, -823, 61, -789, 752, 494, 570, -762, 363,
      844, 217, -33, -197, -35, 933, 55, 80, -460, -364, -611, 378, -565, -299, 700, 46, 173, -324, 105, 724,
      -426, -758, -612, 657, -670, 835, -482, -978, 369, 855, 690, -476, -825, -515, -200, 650, -160, -291, -821, -926,
      785, 428, -379, 98, -309, -457, 9, 269, 686, -128, 734, 534, 816, -119, 315, -274, -534, -377, 352, -568,
      884, -652, -781, -290, -809, 627, -942, 929, 104, -149, -890, 289, 974, 121, -344, -29, 131, 370, 431, 702,
      212, -409, -930, 288, 169, 165, -772, 308, 679, 743, 631, 616, 393, 687, 860, 591, 2, 60, -770, 379,
      253, -193, 854, -904, -246, -789, -954, -985, -256, 390, 652, -597, 723, 456, 996, 622, -610, 988, -415, 554,
      -621, 971, -195, 809, -223, 430, -556, -746, -780, -451, 5, 903, -130, -370, -847, -373, 935, 848, 968, -78,
      812, 108, 283, -670, 448, -414, 257, -17, -601, -797, 420, -480, -361, 11, -893, -705, -466, -6, 212, 608,
      69, -880, -843, -313, 733, -540, -99, -653, 783, -901, -254, 837, -296, -291, 277, 699, 474, -473, -69, 217,
      -353, -277, 323, -465, -22, -504, 846, -250, 225, -884, 241, -35, 426, -968, -683, -558, -620, 363, -504, -275,
      -931, 842, 440, -246, -117, 347, 269, -670, 169, 232, 226, 520, -534, 160, 860, -309, -891, 145, -352, 664,
      -494, 982, 458, 595, -258, 238, 183, -195, 120, -911, 913, -736, 907, 123, -360, -36, 33, -40, -674, 341,
      -467, 671, 146, -330, 944, 380, 301, 536, 650, -121, -920, -963, -234, -727, 966, -128, -352, 354, 445, -504,
      132, -266, -688, 136, -288, -575, 215, -355, -88, 751, 382, 703, 477, 384, -730, -904, -690, 124, -582, 6,
      117, -365, 344, 11, 682, -848, -952, -178, 157, 682, -150, 114, -899, -806, 746, -966, 202, 427, -321, 348};

  std::vector<int> outputArraySeq(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortSeq = std::make_shared<ppc::core::TaskData>();
  hoareSortSeq->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortSeq->inputs_count.emplace_back(inputArray.size());
  hoareSortSeq->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArraySeq.data()));
  hoareSortSeq->outputs_count.emplace_back(inputArray.size());

  HoareSortSequential hoareSortSequential(hoareSortSeq);
  ASSERT_TRUE(hoareSortSequential.validation());
  hoareSortSequential.pre_processing();
  hoareSortSequential.run();
  hoareSortSequential.post_processing();

  std::vector<int> outputArrayOMP(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortOMP = std::make_shared<ppc::core::TaskData>();
  hoareSortOMP->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortOMP->inputs_count.emplace_back(inputArray.size());
  hoareSortOMP->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArrayOMP.data()));
  hoareSortOMP->outputs_count.emplace_back(inputArray.size());

  auto hoareSortOMPParallel = std::make_shared<HoareSortOMP>(hoareSortOMP);

  auto perfAttr = std::make_shared<ppc::core::PerfAttr>();
  perfAttr->num_running = 10;
  perfAttr->current_timer = [&] { return omp_get_wtime(); };

  auto perfResults = std::make_shared<ppc::core::PerfResults>();

  auto perfAnalyzer = std::make_shared<ppc::core::Perf>(hoareSortOMPParallel);
  perfAnalyzer->pipeline_run(perfAttr, perfResults);
  ppc::core::Perf::print_perf_statistic(perfResults);
  ASSERT_EQ(outputArraySeq, outputArrayOMP);
}

TEST(kuznetsov_m_hoare_sort_omp, test_task_run) {
  std::vector inputArray {
      -4399, -4465, 8903, -896, 7408, 9129, 9661, -1037, -7752, -2389, 3408, -6888, -9510, -3180, 2463, -8536, -6947, -3635, 3040, 2364, 
      4623, 9464, 1004, -2914, 3708, -8856, 9317, -2266, -860, -1432, 7691, 1969, -1173, -840, 5471, -6743, 942, -1756, -4904, -8605, 
      6252, 3564, -124, 7969, 7970, -6479, 6447, -195, 1017, 7846, -7776, 309, -872, 9033, 753, -8987, 8937, -9176, -320, 9430, 
      9650, -383, 3356, -4712, 1202, -2928, -9335, -4, -2519, -2177, 5420, -5596, -6612, -8736, 9008, -1963, -5152, 5868, 7842, 4917, 
      2335, -271, -7894, -9102, -1619, 440, -9228, 4656, -7911, 4735, 6667, -4534, 8208, -2355, -4543, 8544, 5897, 329, 6818, -5421, 
      -4574, -4344, 9722, 8599, 2870, -432, -7069, -5153, -5304, 8200, -4141, -1591, -9466, 2742, -6383, 5047, -2465, 3789, 4978, 9870, 
      -7367, 5294, -3942, -5857, 3560, -6792, -7042, -8520, 3168, 3464, 6087, 89, 7444, 507, 8417, 8396, 2638, 822, -4532, 7743, 
      -3562, -5230, 2819, -3819, -4898, 5360, 5011, -6474, -7916, -4313, 8701, 9664, -7344, -8719, -3344, 7938, -5721, 5387, -774, -506, 
      8557, -1423, -1013, -921, -3840, -1882, -9791, -7830, 9493, 1092, -3664, -3478, -5815, -5391, -8052, 3576, 2257, -9928, -7887, -9097, 
      6522, 1751, 6922, 2837, 5885, 1219, -1141, 170, 2930, -116, -1878, 7962, 4015, 4003, 370, 3734, 8837, -696, 5419, -5787, 
      -9713, 7901, -6489, -5244, 1742, 8576, -8124, -9853, 3814, -1867, 110, -5173, -6558, -6438, -6964, -3499, 876, 8550, -3594, 7346, 
      3152, 142, 1543, -5011, 1008, -7931, -2665, 4522, 9313, 9861, -6031, -8647, -9106, -864, 8915, 8621, -6332, 4949, 7034, 6713, 
      9270, -4070, 6123, 1920, 9692, -8713, -3501, 576, -1408, 2411, 6787, 8905, 6486, 5089, -3466, -2129, -1934, -3652, 9392, 9942, 
      7896, 3889, -9833, -1444, 4799, -4468, 3376, 3314, -9468, 1176, -6191, 5553, -2035, 1087, 453, 6849, -6875, 3144, -9855, -6492, 
      -1234, -4771, -8055, 8520, -630, -8220, 2430, -850, -7660, -9891, 3824, -1311, -8898, -2045, -9654, -4944, -9900, 8545, -9803, 3805, 
      3516, 2001, 4212, -8767, 3986, -9737, 5749, -7992, 2745, -7146, -2866, 1932, -8966, 1812, -604, -6711, -2202, 1657, -9086, 8970, 
      -265, 7929, 6934, 8995, 1751, -9199, -4783, 2788, 5538, 5098, 8023, 6760, 4493, 5560, 3611, 2270, -1955, -9088, -878, -465, 
      -6810, -458, 7417, 3761, 7886, 7007, -8993, 9715, 8630, -8490, -2589, -3287, 9061, -5628, -2600, -5850, 1190, 660, 3420, 7322, 
      900, -32, -2699, 5456, 2477, -1076, 4290, 6173, -4272, 3274, -7727, -3599, 1934, 2461, -5220, 9421, -2655, 5033, -9393, -7541, 
      4956, 7146, 7991, 6760, -7253, 6227, 4534, -7440, -250, 510, -8488, 1505, 5186, -4418, 7185, 1154, 8142, 5623, -7998, -7988, 
      -4010, -352, -4348, 3807, 4951, 5756, 132, 5778, -4531, -3308, 9712, 1267, 5205, -2761, -5309, 9344, 9131, -4710, -3992, -6100, 
      -7920, 849, 3597, -2313, -1843, 2198, 7226, -1580, 8153, 3297, 7511, -4344, -4292, -2623, -31, -5104, -2489, 7035, 2714, 2388, 
      -1822, -9149, 723, 2724, 7707, 951, 7721, -8238, -3206, -860, 4373, 5968, 8619, -3159, -7541, -4559, 6037, -1640, 589, -3829, 
      8409, -3530, -7296, 9521, -2542, -9993, -1439, -7471, -4726, -3696, 4917, -456, 8879, -8829, 4888, -9033, -1680, 2256, 202, -1947, 
      -5776, -2389, -7609, -1361, 9116, -3558, 3438, 1192, 4515, -5078, 7891, -6262, 1065, 3220, -1586, 8782, -3249, 2626, 9756, 4268, 
      -3717, 578, 5977, -5876, -6624, 6201, 1347, 1475, 5097, 4911, 1051, 7293, 8649, -8309, 54, -4200, -3699, 3218, 4800, -6777, 
      3719, 7391, -144, -5651, -4710, -8647, 5777, 7123, -1479, 7109, 9523, 328, -9278, -1193, -7437, 6511, -3088, 4751, 4242, 1128, 
      2039, 3223, -8892, 4179, -3107, -9424, -4891, 868, -2678, 3020, -7211, -4226, -494, -9545, -3004, 3942, -5312, 297, 9367, -367, 
      628, -5531, 7904, 2269, -6945, -8660, 6823, -32, 6702, -8180, -4844, 9192, 2727, -6945, -6839, -4755, 3393, -8534, 5270, -3546, 
      8271, -631, -7031, 7415, -630, 9235, 8446, 5396, 4555, 4895, 4885, -7208, -3478, 5245, -7431, 3692, -4158, -1020, 7701, 2017, 
      9795, -5030, 2462, 4839, -1270, -8973, -1430, -5052, 817, 2425, 7820, -9628, 5315, -4079, 8866, -8204, 5011, -8317, -9626, -8326, 
      203, 8490, 7753, -4701, -9378, 2847, -2296, 9252, 1482, -4764, -5180, 9791, 2710, -4781, 5543, -8677, 2242, 5021, 4050, 9474, 
      2598, -4491, -8680, 2445, 5857, -8989, 1543, -881, 9258, 9348, 2827, 1068, -4439, 7683, -5697, 8597, -5481, 1209, -4519, 8250, 
      -7142, 330, -66, -8505, -1428, -7161, 1427, -1192, -9165, 3231, 7104, -5094, -3173, 7691, -641, -2279, -6749, 7967, -8292, -9614, 
      -530, -3545, -3831, -9934, -9162, 3229, -7704, -2342, -1655, 3730, -430, 2277, 4129, -8866, -2668, -4920, 9592, 1244, 6220, -2918, 
      7506, 3331, -6805, 7652, -9966, 2566, -8519, -9921, -4885, -5868, -9224, 1694, -1336, 7260, -1779, 9228, -5072, -9940, 2990, -9008, 
      -8460, -9207, 8543, -9034, 8642, 4776, 9753, 3923, 8591, 2088, -4307, 8253, 3303, 5762, -2628, 5950, 6615, 5400, 1304, -9631, 
      -9709, -3814, -7223, 928, 3451, 5473, -8540, -3431, -7548, -651, -2860, 4886, -1440, -1702, -594, -4326, 1962, 5403, 7977, -3212, 
      7735, 8263, 2534, -6802, -4844, 9151, -9011, -8599, 6628, 2404, 1183, 1227, 6907, -9583, 1390, 1977, 9021, 2934, -9445, -3454, 
      4871, 7280, -2144, -1777, -3076, -2396, 5458, 1621, 8419, 5542, -1270, 8466, -4611, -4622, -3449, 4523, 4241, 371, -732, 4209, 
      3962, -8150, 935, 693, 5486, 8764, -4680, -4960, 4342, 7655, 3876, -2434, 8233, 9160, 1660, -8550, -1446, 2013, -9902, 7078, 
      8041, 7815, 6353, 6294, -6384, -6972, -2371, -6641, 149, -5080, 3026, -1047, -8137, 3399, 8621, 7922, 976, 8938, 5308, 2492, 
      4483, -3049, 8927, -5012, 9860, -5798, -5224, 8914, -9018, -2647, 4229, -7263, -9056, -8488, 4307, -9335, -2720, 5440, 6916, 8615, 
      3680, 7174, 8114, -8870, -2308, 2770, 9767, 318, -4962, -406, -918, 4689, 7677, -2594, -7033, 9181, -5232, -4059, 566, -6047, 
      5785, -2480, 7960, -9301, -8111, 9330, 5865, -6842, 7495, -7275, -4563, 3100, 4542, -2532, 5270, 120, -5553, -7685, -3707, 5385, 
      4106, 2547, 8901, -9859, 3430, 2821, 217, -1645, -4428, 443, 7625, -7078, -6346, 4904, -2100, -2518, 5300, -1626, 2414, 228, 
      -5319, 8136, -7856, -9602, 4079, 2479, 9908, -6910, 8746, -5470, -5727, -1100, 637, -4025, 9, 6610, -7124, -88, -361, -2387, 
      -3866, 2938, 5822, -9814, 5091, -904, -7368, -9273, 790, -9679, -3358, -9634, 5245, -6511, -3630, -2721, 528, 9286, -1611, 3157, 
      -4403, 7517, 310, 2245, -5176, 771, -8359, -7400, 8253, 2680, 3751, 8358, 2327, -9282, -8710, 3972, -55, 6462, 2030, 7691, 
      3705, 2392, 4494, -9475, 7714, 1289, 3161, -9361, 7715, 8, 1354, 4561, -5225, 6995, 6949, -934, 9503, 3405, -949, -3204, 
      -9833, 7342, -5879, -4959, 4288, -3184, -291, -7165, -2609, 6966, -974, -2747, -1804, 4896, -7209, -6051, -72, 8666, 831, -5150, 
      -6516, -1353, 7257, -5330, 5060, 1098, -8050, -3267, 2516, 1437, -2931, -9625, 8670, -5467, -8595, -2228, 7365, 3129, -980, -2846, 
      453, -6814, -5552, 8482, 7672, -7455, 2109, 1279, 9815, 2269, -5846, -2301, 3331, -1450, -8911, -8669, 5189, -1526, 586, 2172, 
      3464, 3695, -5352, 6187, 6812, 7754, -3427, 5477, 1187, -9634, -2046, -1871, 5345, -5999, 3492, -9075, 8718, 5622, -4262, -9266, 
      2324, -9281, 3400, -595, -1843, 464, 3618, 26, -9497, 4790, 9274, 5208, -6300, -550, -7102, 3986, -7020, 6065, -1777, 3168, 
      -3067, 6131, 8724, -290, -3905, 4363, -1380, 3718, 3194, 7037, -9389, 4178, 7952, -1472, 6000, -2177, -7305, 2145, -389, -7861, 
      8040, -3851, 3307, 3828, 8534, -3695, 8308, 2967, 4888, -3533, -7180, -686, 7581, -5711, 3284, 4473, -8447, -659, 8993, 1300, 
      7540, 9784, -3041, 8939, -5678, 585, -2535, -675, -5753, -1116, 5577, 2948, -5975, -391, 1468, -1550, 2086, 5841, -4424, -6508, 
      1107, 577, 7252, -7665, -8279, 2605, -90, -3496, -9489, 4400, -4687, -7709, 5381, 7549, 2302, -3623, 7591, -4913, 9786, -2330, 
      -3508, 9513, 5697, 7004, 4646, 9979, 2657, -3801, 4274, 1527, 5955, 858, 2517, 4650, -5064, 640, 4783, -9936, 3177, 7861, 
      3497, 9622, 5931, 368, 7268, 728, 9592, 9062, -6176, -9628, -6803, 5138, 5038, 5826, -3369, 4906, 7505, 8439, -6559, -7223, 
      -7360, 8852, 7669, 3663, 1155, -5911, -2804, 5161, 133, -2167, -2003, -3758, -7900, -8634, -7842, -6015, -3018, -9620, 9551, -5543, 
      7898, -7094, 503, 6349, -5242, 4272, 102, 5917, -7550, 1919, -6850, 2584, -3090, 9586, -9979, -7037, -5723, -3631, 4748, 2106, 
      9723, 8956, -864, 4656, -2860, 9902, -1869, 9218, -9431, 1923, -1401, 829, 3414, 4698, -6628, -3332, -7091, 2893, 5332, -3497, 
      -2997, 5943, 2399, -439, 7459, -3231, 5418, -2021, -8383, 1731, 5424, 9153, -537, 9511, 8352, -3544, -4632, -5608, 2057, -5032, 
      -5555, 3784, 3341, 8786, 5196, 5704, 9778, -1777, 9458, -2676, -9024, -1878, -4726, -7575, 5195, 6206, 7525, 1127, 583, -1688, 
      5385, 7602, 6401, 154, -3128, -7703, -4180, 924, -3456, -9701, -2539, -8341, 8677, -7020, -3155, 9765, -3595, 4879, -2228, 2247, 
      -8415, -7836, -490, -9874, -8873, 7089, -7540, 448, 8016, 9139, 2206, -5747, 754, 1329, 7682, -6612, -7706, -1671, 8397, -4265, 
      4214, -3581, -6875, -738, -3882, 44, -433, 4888, 4998, 9239, -4167, 1501, 3337, 37, 5556, 9128, 6651, 9911, 663, 4370, 
      -4818, 5842, -6451, 5172, 1046, -1199, 9425, 4619, -241, 6648, -2949, -8936, -4353, -869, 8782, 397, 1598, 7318, 1800, -6659, 
      5406, -9722, 7484, 9941, 227, -8411, -302, -7414, -3840, 5221, 9371, 262, 2548, 5804, -3153, 8527, -2686, -9789, 2801, -4574, 
      -3751, -7791, 363, 3072, -1357, -9070, 3505, -2286, 7137, 7012, -4733, 3654, -6362, -6278, 8072, -1435, -4098, -3926, 1669, -8921, 
      8692, -2150, 8425, -3559, 3537, -9946, -6706, -2498, 5493, -6698, 8526, 9319, -2267, 1077, 5565, 872, -2704, 7635, 3299, -9964, 
      -4749, 3784, -6968, -7978, -4815, -1786, 272, 11, -4905, -6077, 657, 2998, -5195, -3461, -284, 9844, -8546, -5150, -3767, 114, 
      -6595, 7903, -3083, -7270, -3989, -6796, -3132, -946, -4943, -6537, 6040, 7955, -7510, -3482, 4364, 3123, 1475, -5680, 6049, 2781, 
      -1242, -3505, -6209, 2860, -1313, 7832, 8312, -9522, -9737, 9776, 4656, -2407, 4131, 1955, -6502, -3976, -1731, 24, 3305, -4606, 
      -5261, 1702, 4589, -9723, -3887, -7992, 4603, 3011, 6223, -3653, -4285, 8174, 6185, 5857, 2845, -2575, -7834, -9845, -2286, 9885, 
      3091, -2894, 439, 5461, 9570, -6924, 8866, -2607, -9436, 2969, 6858, 7433, 8105, -2476, -3750, -3736, 9065, -3098, 6050, 3619, 
      -8285, -2497, 1637, 1344, 8250, 8484, 7702, 9045, -934, -9831, 1675, 1395, -1801, -2739, -6465, 1646, -8025, -1521, -863, 154, 
      3779, -5367, 9168, -5940, -3155, 4806, -8664, 2022, -3893, -9647, -9489, 2180, 7057, -2060, 3344, -286, -4850, -5187, 9787, 7346, 
      2200, 4837, -4271, -2744, 1746, -2925, -4330, 8956, -5102, -3710, 4134, 5196, 1882, 4130, -7390, -1065, 1610, -5654, -4108, 746, 
      -8677, 3456, -5545, 9591, -8462, -2564, -9983, -9890, 2095, -7134, -4038, 5906, -2409, 2727, -6061, -7947, 5167, -1472, -8291, 3985, 
      5062, -9225, 4842, -3993, -4836, -2604, -9143, 5232, -7237, 2281, 2525, 3612, 7819, -977, 6741, 6940, 8561, 8440, -3489, -8156, 
      -4643, 6367, -4548, -3347, -6790, 9715, -7358, -8188, 1253, -6831, -9335, 3749, -1755, 7492, 3234, 4416, 9596, 6012, -1529, 5229, 
      9558, 973, 9069, 384, -5290, 1237, -3712, 9399, 3654, 8288, -5606, -4131, 3278, -1803, -2731, 4813, -2695, -3913, -5148, -6544, 
      -8484, 1772, -256, 5380, -2034, -5272, 20, 599, 6406, -8889, 9710, 1477, 9090, 4320, -9173, -8374, 6008, -7197, 529, -6249, 
      5410, 3907, -9672, -8034, -8765, -5141, 5349, 7409, -2688, -4349, 2594, -4292, 4758, -7054, 7395, 288, 6951, -3517, -2554, -7165, 
      -1129, 4220, -3520, 8722, -7886, 4870, 661, -9843, -6207, -526, -8784, 4927, -6289, 518, 8196, 7945, -4483, 3114, -4915, 5066, 
      2094, -2108, 6534, 4851, -535, 742, -2457, 4519, -9743, 692, 9158, -348, -1343, -1323, 9576, 5540, -7832, -4850, -4550, -7834, 
      6698, 3548, -509, 7904, 4376, -8273, -8906, 1471, -9508, 1428, 9263, -4903, 9473, -2565, 7073, 9031, -9522, -3068, 9590, 4562, 
      8917, 7337, -3022, 1335, 9747, 1865, -3044, -2745, -4065, -6322, -9576, 2748, -6442, -2574, 6245, -6141, -608, 6988, 1657, -846, 
      -2447, 2250, -5393, 2594, -7031, 5071, -8271, 1820, -8727, 934, 4174, 6914, 2661, -1354, -621, 9825, -9450, -6187, 7750, -5174, 
      919, 2992, 4920, -9384, -2085, 3218, -4942, -9518, 4487, -5208, -4904, -5659, 2135, 2796, 9225, -4878, -5992, -2915, 776, 1921, 
      8802, 8258, -4324, -8327, -7545, -7519, 1457, -6782, -4710, 5668, -2096, 7203, 8543, 9893, 3238, -1080, 4374, -8305, 8772, 2399, 
      -9262, -2602, 5672, -2474, 4038, -3819, 7498, 3173, -7070, -2846, 9074, 7162, -2290, -1446, 6502, 4097, -8671, 2607, -5433, 9553, 
      2924, -6958, 6341, -1134, 2314, 2184, 6593, 3634, -7177, -1191, -6582, -1333, -4814, 3935, -5779, -4395, 4710, -4885, -8648, 8068, 
      -1105, -71, 4447, 3122, -5183, 290, 2441, 5619, 6441, 8280, -1369, -4394, -3577, 2533, -5532, -4991, 4298, -2118, 112, 2464, 
      994, -5159, 2185, -3208, 8563, 7963, 216, 2358, 1374, 3881, 3728, -6615, 940, 5491, 2118, -9477, 938, -9568, -746, -3434, 
      7111, -4864, -7616, 6010, -6613, -3695, 1679, 1436, 7648, 2415, -8566, 228, 8588, -7190, 203, -416, 7900, 899, 8570, 9475, 
      -78, -6528, 8657, -70, 7983, 2499, -8281, -9765, 1602, 4886, 4458, 8955, 7354, 7876, -7821, -8271, 1524, 4106, 2610, 258, 
      -3813, 7678, -3320, 1597, 8064, 2056, -310, 4292, 2385, -6714, -6275, 2252, -4904, 6420, -1364, -317, -1682, -1405, 3961, 4786, 
      -7848, 3709, 47, 810, -8087, 3651, -7760, -6049, -705, 2758, -8823, -7737, 8305, -6203, -4691, 6184, -4346, 2922, -6495, -1307, 
      -2539, -5603, -3612, 6487, -7612, 8456, -7436, 1225, -7388, 8037, -2843, -774, -2289, 1958, 4498, -2393, -2823, -8013, -9459, -8241, 
      6257, -1830, 471, -2818, 3760, 5672, 4882, -2979, -3144, 6914, -8627, 1371, 7915, -404, -3394, 3966, 2038, -2267, -5814, -4792, 
      1171, -3551, 7856, 1788, 1221, 315, 9231, 6779, -9462, -3218, -4276, 5091, -4102, 2113, 4040, -6888, 1106, 9505, 9159, 1001, 
      -6548, 281, -5438, 3686, 6157, -6392, 460, 9883, -1941, -5663, -5658, 43, -9508, 1486, 7407, -7010, 2597, 6402, -7392, -6889, 
      5246, 5507, -2886, 3751, 7656, 4048, 2076, 3046, 9640, -1180, -785, -5338, -8106, 7621, -4431, -5321, -8683, 6737, -7859, -3582, 
      -2178, 3286, -2172, -6489, 2545, 7602, -9520, 6404, -6483, -6570, -4021, 9047, -18, 1850, -7910, -8686, 6425, -7482, 4744, 9004, 
      1732, -3855, 922, 4513, 4263, -5195, 8156, 3201, -3115, 3017, -448, -2163, -1783, 5006, -2239, 6604, -5595, -7741, 1166, -3322, 
      5333, -1348, -4744, -4192, 8517, -1457, -4648, -2022, -6156, 9743, -1822, -7925, -3308, -9889, -4668, 3963, 7865, -1801, 5909, 8159, 
      2445, 1056, -8473, -622, 3675, 2867, 6778, 6514, -5589, -7257, 597, -1742, 5801, -7074, 1129, -2479, 6300, 6226, 1374, -7555, 
      -251, -3003, -7803, 1774, 7881, 5089, -9630, -1591, 8040, -2265, -2178, -1378, 4170, -8473, -4738, 8425, -7202, -5651, -722, 7910, 
      -6075, -3649, 1633, -4893, -1640, 4471, 9262, 3663, -751, 8385, 7928, 3230, -6157, -7785, -5266, -8135, -957, -3504, -800, 5651, 
      6595, -7561, 8755, 3201, 9972, -27, 8644, 704, 1269, -1000, -867, 6245, -7202, 3331, 3331, -1438, 8848, 2153, 3244, -9272, 
      938, 6634, 2954, 8695, -3274, 1729, 966, 5295, 5094, -7282, -3246, -7196, -523, 1178, 4186, -6355, 8724, -3093, -8197, -9564, 
      9284, -78, -7202, -7234, -8169, -5382, 5617, -9545, 7521, 5974, 3074, 9747, 4190, -5291, -9497, 5746, -8556, 8522, 2519, -8265, 
      1124, 2570, 9852, 2664, 2787, 6615, -7337, 3436, -9497, -1243, -3500, 2104, 448, 7287, 3329, -789, 6539, 2101, 5075, 657, 
      -1800, -333, -8565, 4080, -360, 9169, 7870, -9693, 2921, -5779, -7596, -8278, -1468, -7038, 9985, -7578, -3192, 7747, -1183, 3570, 
      7452, 2346, 9625, -7172, 1345, 1714, 2558, -4161, -1100, -6165, -619, 3590, -3446, -4011, 9477, 7750, 4341, -62, -4074, 899, 
      -4492, -1322, 4179, 9108, 1956, 2288, 6430, -8465, -3809, -1131, 1411, -9025, 9916, -3220, 8869, 5146, 9100, 1131, 7348, 8050};

  std::vector<int> outputArraySeq(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortSeq = std::make_shared<ppc::core::TaskData>();
  hoareSortSeq->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortSeq->inputs_count.emplace_back(inputArray.size());
  hoareSortSeq->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArraySeq.data()));
  hoareSortSeq->outputs_count.emplace_back(inputArray.size());

  HoareSortSequential hoareSortSequential(hoareSortSeq);
  ASSERT_TRUE(hoareSortSequential.validation());
  hoareSortSequential.pre_processing();
  hoareSortSequential.run();
  hoareSortSequential.post_processing();

  std::vector<int> outputArrayOMP(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortOMP = std::make_shared<ppc::core::TaskData>();
  hoareSortOMP->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortOMP->inputs_count.emplace_back(inputArray.size());
  hoareSortOMP->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArrayOMP.data()));
  hoareSortOMP->outputs_count.emplace_back(inputArray.size());

  auto hoareSortOMPParallel = std::make_shared<HoareSortOMP>(hoareSortOMP);

  auto perfAttr = std::make_shared<ppc::core::PerfAttr>();
  perfAttr->num_running = 10;
  perfAttr->current_timer = [&] { return omp_get_wtime(); };

  auto perfResults = std::make_shared<ppc::core::PerfResults>();

  auto perfAnalyzer = std::make_shared<ppc::core::Perf>(hoareSortOMPParallel);
  perfAnalyzer->task_run(perfAttr, perfResults);
  ppc::core::Perf::print_perf_statistic(perfResults);
  ASSERT_EQ(outputArraySeq, outputArrayOMP);
}