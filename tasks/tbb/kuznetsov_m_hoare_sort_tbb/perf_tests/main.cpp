// Copyright 2024 Kuznetsov Mikhail
#include <gtest/gtest.h>
#include <omp.h>

#include <algorithm>
#include <vector>

#include "core/perf/include/perf.hpp"
#include "tbb/kuznetsov_m_hoare_sort_tbb/include/kuznetsov_hoare_sort_tbb.hpp"

using namespace kuznetsov_tbb;

TEST(kuznetsov_m_hoare_sort_tbb, test_pipeline_run) {
  std::vector<int> inputArray = {
      -690, 198,  208,  -566, 925,  551,  -503,  900,  -71,  -394, 462,  -774, -557, 34,   684,  -841, 639,  -63,  -892,
      475,  -996, -676, 326,  996,  -870, 800,   121,  560,  -169, -766, -864, 396,  26,   834,  500,  620,  877,  -141,
      519,  -401, -49,  149,  852,  -553, 192,   -862, 840,  -26,  746,  827,  -275, 688,  -941, -780, -540, 3,    468,
      439,  0,    -48,  -525, 282,  451,  -289,  55,   343,  -674, 358,  827,  766,  -375, 912,  786,  171,  757,  -623,
      28,   -963, -806, -112, -610, -710, -495,  851,  162,  -17,  -497, 459,  -569, 65,   496,  -174, 329,  -405, 802,
      534,  -330, 584,  439,  -274, 963,  -240,  737,  -47,  -472, -226, 589,  90,   -319, -72,  207,  -811, 429,  146,
      93,   -979, 393,  660,  796,  -474, -273,  842,  -992, 602,  -340, -163, 408,  359,  828,  -390, 821,  603,  511,
      -578, -800, -317, -637, 917,  923,  643,   -348, 81,   -568, 343,  389,  -722, -60,  167,  698,  -883, 245,  -526,
      -716, -676, -957, 977,  538,  -22,  785,   188,  -865, 627,  -834, -167, 262,  -281, 375,  727,  -752, -643, -192,
      -353, -685, 782,  -329, 190,  922,  538,   278,  -517, -642, 102,  848,  -144, -434, -31,  826,  -387, -989, 851,
      273,  905,  262,  697,  -933, 471,  450,   448,  667,  -244, 737,  -282, -589, 986,  -86,  632,  608,  -14,  963,
      694,  158,  -253, 130,  -63,  -785, -951,  418,  -637, -189, 637,  -793, -573, 888,  -4,   941,  212,  408,  -378,
      -882, 833,  425,  -381, -31,  349,  -672,  -846, -64,  -503, 184,  -845, 520,  -563, 729,  -847, -553, 219,  -734,
      -861, -500, -798, 973,  -493, 730,  -667,  402,  748,  784,  -668, -906, -534, 476,  837,  -670, -210, -521, 219,
      826,  306,  301,  635,  -2,   -484, 781,   -885, 782,  17,   843,  613,  -418, -651, -653, 731,  672,  819,  702,
      -694, -744, 671,  899,  -185, 515,  0,     -442, 368,  757,  768,  401,  909,  143,  -227, 145,  762,  -864, -213,
      645,  -25,  -564, 881,  -303, -985, 966,   -464, 212,  84,   55,   -660, 283,  841,  -255, 818,  -212, 320,  -668,
      -880, 725,  -270, 529,  -394, -44,  487,   213,  846,  647,  497,  -939, -624, -477, 830,  972,  589,  -478, 70,
      466,  205,  -930, 310,  -281, -629, 40,    598,  -191, -33,  821,  -876, 80,   635,  -156, 467,  43,   -829, -226,
      963,  143,  -954, 670,  610,  -306, -258,  676,  -889, -948, -618, -577, -444, 358,  -220, -828, 187,  -226, -591,
      395,  935,  765,  294,  -624, -466, -45,   -216, 748,  64,   -235, -361, -755, 988,  944,  -585, 3,    -575, 718,
      546,  672,  -519, 171,  -619, -924, -803,  453,  493,  573,  -178, 767,  -81,  -100, -488, -799, -565, -849, 419,
      205,  970,  -490, 823,  103,  -688, -630,  450,  32,   402,  -550, -54,  978,  -991, -295, 367,  -303, 983,  916,
      526,  -2,   -994, 45,   -640, 553,  255,   398,  92,   181,  602,  -189, -157, 88,   -128, -119, 75,   8,    -103,
      515,  263,  182,  -296, -260, -559, 252,   -379, 745,  -102, -493, 270,  -994, 803,  -342, 946,  642,  -605, -309,
      301,  -583, 879,  -900, 988,  -920, -342,  -375, 255,  548,  -698, 857,  185,  985,  -650, -783, -621, -677, 710,
      -129, -271, -19,  929,  -710, 772,  424,   109,  -530, 234,  -196, 204,  -755, 686,  83,   794,  105,  -243, 790,
      -132, -363, 239,  743,  -147, -752, -831,  -903, -736, 675,  -341, 517,  -213, -723, 252,  -347, -306, -354, -716,
      598,  -878, 618,  -672, -129, -135, -31,   -645, 56,   967,  629,  332,  -144, -800, -375, 897,  -279, 551,  241,
      -196, -508, -332, -251, 789,  731,  -873,  -508, 889,  189,  631,  -420, 455,  681,  -412, 462,  -66,  189,  103,
      -241, 227,  -624, 33,   -484, -626, -294,  -709, -413, 599,  -327, 81,   -994, -260, 52,   -427, 799,  -407, 493,
      -396, 746,  -305, -166, 406,  -542, -511,  935,  310,  211,  -519, 789,  -728, -85,  970,  746,  -226, 361,  -380,
      -332, -644, -508, 866,  136,  88,   797,   225,  -643, 890,  -748, 772,  -407, -155, -913, -743, -974, 810,  122,
      -832, -955, 474,  538,  477,  782,  -105,  -924, -44,  -885, -83,  -604, -609, -380, 678,  533,  -781, 434,  164,
      885,  832,  -212, -242, 610,  113,  -536,  -898, -276, 354,  736,  822,  174,  -854, 126,  737,  502,  743,  -544,
      73,   945,  297,  -436, 690,  -18,  -914,  827,  -631, -480, 246,  523,  -506, -773, 612,  -362, -984, 630,  -567,
      -977, 123,  -469, -256, 176,  -851, -1000, -457, 674,  270,  -665, -254, -618, 374,  96,   796,  -20,  -773, -880,
      -861, 374,  -634, 822,  -696, 757,  -323,  -463, -644, 250,  702,  -94,  -418, -160, -899, 815,  917,  60,   -604,
      -934, -815, 705,  -483, -20,  604,  -422,  -955, -681, 280,  -428, -151, 360,  961,  592,  440,  865,  -944, 666,
      458,  284,  -749, -19,  -373, -551, -283,  467,  547,  375,  -188, -746, -656, -546, 186,  34,   -41,  797,  397,
      146,  855,  862,  -338, -446, -914, -11,   -60,  871,  871,  -572, -437, -302, 799,  24,   996,  -606, -373, -881,
      -666, -964, -559, 851,  392,  -221, -942,  -464, -559, -331, 572,  223,  966,  723,  -184, -219, 394,  43,   -581,
      506,  -589, 149,  -353, -965, 793,  202,   -414, -98,  -134, 648,  -386, -218, 229,  -799, -456, 550,  710,  372,
      708,  739,  135,  -12,  7,    -587, -984,  -413, -679, 345,  -878, 69,   -192, 517,  464,  910,  -666, -96,  862,
      915,  367,  -536, -776, 628,  -773, 280,   -820, 633,  470,  -582, -550, 707,  219,  235,  203,  853,  211,  -500,
      -346, 497,  616,  -629, -372, 41,   -317,  -572, -681, 143,  732,  920,  173,  -57,  320,  987,  -991, 72,   -888,
      -449, 184,  -102, -709, 424,  -227, 451,   572,  773,  220,  580,  -408, 225,  727,  -448, 977,  852,  843,  264,
      975,  599,  472,  643,  -772, -237, -345,  -11,  -348, 577,  200,  -157, 612,  813,  258,  -644, 656,  647,  137,
      857,  506,  728,  960,  -498, -273, -40,   -739, -646, 686,  -66,  851,  579,  -954, -794, -150, -32,  -685, -596,
      -952, -123, -484, -643, 376,  258,  565,   855,  554,  201,  386,  -566, -288, 161,  -32,  -778, -465, 49,   -711,
      -649, 459,  -523, 405,  -509, -336, -542,  990,  797,  393,  659,  288,  847,  -976, 902,  262,  -820, 358,  -469,
      771,  -519, 579,  908,  602,  199,  941,   -458, 548,  -420, -232, 248,  725,  -738, 112,  509,  -167, 942,  740,
      228,  301,  -564, -776, 928,  494,  210,   541,  -844, -311, 194,  -291, -29,  717,  55,   206,  614,  -776, 474,
      922,  260,  -343, -178, 904,  -549, -817,  -873, 130,  375,  -758, 334,  -561, 550,  -253, 486,  204,  -657, -552,
      -953, -532, 603,  609,  861,  269,  387,   589,  -376, 910,  -231, -631, -168, 866,  -277, -648, 47,   -264, -820,
      -283, -989, -850, 558,  230,  -131, 117,   506,  -951, 148,  603,  -960, 806,  -363, -113, 44,   -724, -914, 723,
      -42,  718,  217,  777,  -735, 524,  422,   428,  235,  -936, 779,  -558, -706, -966, 993,  -436, -659, 686,  -39,
      71,   934,  -869, -799, -688, -876, -159,  -122, 765,  532,  -547, 466,  -855, -165, -690, 94,   217,  377,  -205,
      -292, -496, 661,  -631, 786,  -269, 943,   883,  91,   888,  -44,  -969, 775,  -314, 219,  -451, 353,  960,  -124,
      427,  -69,  294,  -37,  782,  -891, 848,   166,  -140, -401, 326,  -237, 263,  -96,  567,  418,  -880, 72,   60,
      -95,  98,   831,  124,  -263, 422,  716,   820,  526,  317,  -811, -533, 863,  -90,  -4,   -358, 789,  667,  515,
      870,  -353, 560,  -609, -427, 744,  -757,  76,   -24,  -559, 661,  157,  234,  -153, 30,   481,  -524, 162,  908,
      -169, 341,  -462, 50,   -693, -383, 917,   -266, -568, 672,  -335, 142,  124,  777,  -553, 863,  433,  224,  479,
      422,  354,  -706, 758,  886,  86,   -807,  -954, -110, -795, 37,   279,  -248, 545,  281,  -153, -181, 758,  983,
      614,  919,  -751, 138,  -77,  -596, 288,   383,  520,  276,  -387, 73,   -501, 5,    -821, 623,  -332, -148, -479,
      362,  845,  -699, 182,  153,  448,  792,   -836, 392,  -348, -344, 775,  425,  532,  93,   -852, -412, -904, -315,
      -933, 164,  99,   -189, -176, -338, 137,   -590, -894, -238, -792, -624, 510,  576,  -64,  307,  782,  158,  -958,
      -932, -557, -399, -582, -59,  -764, -170,  96,   585,  486,  -474, 85,   237,  149,  27,   228,  576,  -919, -212,
      -860, -814, 960,  -56,  -952, -71,  -497,  -954, 891,  -688, 281,  459,  -120, 118,  241,  -417, -986, -401, -577,
      675,  -798, 974,  -110, 167,  659,  -734,  -146, -23,  369,  534,  626,  -455, -767, -410, -17,  -383, 993,  72,
      547,  -890, -251, 32,   -655, -420, -24,   -43,  27,   101,  -290, 761,  -881, -621, 247,  -600, -445, -886, -67,
      534,  -277, -897, -57,  -724, -630, 764,   -76,  820,  -86,  -491, 933,  251,  -796, -589, 272,  -181, -127, -708,
      66,   -903, -445, -817, 317,  -751, 710,   -119, 160,  654,  210,  401,  -349, 982,  652,  651,  700,  -397, -138,
      -288, -530, -504, 847,  171,  -984, -13,   774,  333,  557,  -539, -388, -796, -62,  -483, -649, 72,   931,  73,
      738,  -192, -204, 946,  350,  -880, 582,   -77,  -623, -852, 123,  193,  501,  -927, 92,   -73,  453,  -891, -772,
      -165, -767, 909,  600,  -520, -198, 933,   -438, -802, -350, 786,  674,  885,  -92,  169,  -285, 506,  695,  -619,
      -546, 968,  -751, 836,  -764, -242, 271,   -244, -274, -578, 540,  198,  -652, -801, 354,  -71,  -323, -634, 843,
      611,  47,   462,  670,  -695, -873, 472,   280,  706,  -106, -495, 141,  268,  453,  207,  -669, 689,  270,  171,
      30,   881,  -564, -22,  137,  -24,  -757,  260,  972,  -87,  -578, -765, 541,  750,  510,  834,  635,  -217, -353,
      605,  951,  -773, -78,  633,  546,  929,   491,  -755, -985, -51,  -774, 350,  741,  -238, -570, -911, -212, 420,
      775,  765,  -22,  924,  11,   975,  560,   -143, -26,  726,  101,  -535, -249, -816, -325, 81,   -32,  707,  539,
      -392, 666,  -405, -204, -766, -886, -393,  663,  654,  863,  385,  -583, 278,  -843, 842,  241,  -993, -566, 714,
      293,  -578, 582,  955,  -268, 104,  920,   374,  -962, 367,  331,  959,  752,  -171, -433, -420, 578,  -110, 638,
      -244, 800,  222,  -863, 392,  -716, -733,  599,  71,   458,  -967, -279, -378, 736,  -879, -355, -809, 190,  328,
      430,  935,  -204, 176,  935,  -937, -192,  -839, 355,  -944, -830, 401,  348,  -31,  628,  62,   -615, 580,  684,
      698,  121,  -565, 614,  -694, -480, -437,  -863, -262, -714, -148, 175,  573,  -860, 500,  239,  61,   -250, 518,
      864,  -22,  -323, 621,  -318, 126,  436,   -564, -346, -168, -424, 832,  -85,  -436, -475, 841,  -344, 501,  663,
      570,  265,  -949, -581, -542, 434,  -122,  -972, -184, 463,  563,  -801, -660, 732,  750,  759,  53,   900,  807,
      770,  -31,  -776, 240,  -864, 882,  542,   750,  -619, -43,  902,  -233, 613,  -840, -169, 988,  666,  -170, -798,
      -46,  13,   -899, 856,  551,  851,  564,   497,  864,  523,  7,    -378, 277,  811,  -54,  392,  -846, 903,  -102,
      885,  -195, 930,  481,  -737, -421, 99,    -230, -177, -613, -470, 777,  -946, -638, 455,  677,  71,   -758, 478,
      956,  -890, -736, 880,  438,  326,  -399,  -228, -822, 62,   -540, 22,   796,  692,  968,  -911, -746, -137, -824,
      -29,  293,  198,  -169, -257, 747,  690,   107,  -857, -846, 596,  -865, -63,  67,   608,  913,  815,  -764, 494,
      681,  853,  503,  -12,  -376, -441, -883,  610,  822,  382,  -236, 604,  -91,  -231, -787, -5,   45,   -722, -662,
      -274, -537, -823, -908, -586, 308,  713,   962,  835,  -24,  -267, -107, -126, 624,  108,  -762, -48,  -984, -38,
      634,  847,  -704, -718, 755,  -437, 842,   761,  -673, -456, -731, -799, -376, 428,  -986, 218,  -643, -670, -777,
      651,  954,  418,  712,  640,  -571, -725,  -835, -760, -359, 465,  -970, -241, 17,   -733, 972,  788,  -573, 417,
      -410, 603,  -484, 582,  -80,  -639, -677,  564,  379,  549,  -762, -966, -760, 353,  607,  3,    -927, -931, 205,
      436,  -253, 50,   -584, 1,    543,  -794,  -277, -892, 799,  -107, -199, 67,   17,   688,  -844, -869, -249, -160,
      -57,  -651, 779,  343,  778,  -634, -40,   -482, 93,   -692, -64,  -825, 184,  286,  -582, 441,  169,  -563, -632,
      -611, 666,  142,  635,  399,  907,  911,   -452, 849,  41,   -728, -249, 353,  -560, 703,  -291, -99,  745,  878,
      620,  667,  913,  -238, 517,  -952, 632,   24,   -787, 830,  -988, -130, -749, -997, -455, -968, 722,  -947, -499,
      404,  443,  -754, 311,  -823, -187, 424,   -586, 91,   -813, -195, -176, -114, -379, -72,  -187, -172, -299, -517,
      768,  -132, -403, -352, 764,  -20,  262,   570,  935,  104,  -660, -915, 520,  -490, -949, 581,  -552, -340, 46,
      -957, 552,  -100, -403, -140, -155, -110,  -786, 0,    -994, 818,  -936, 444,  -815, -366, -905, 22,   -921, -105,
      -517, -674, -578, 298,  783};

  std::vector<int> outputArraySeq(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortSeq = std::make_shared<ppc::core::TaskData>();
  hoareSortSeq->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortSeq->inputs_count.emplace_back(inputArray.size());
  hoareSortSeq->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArraySeq.data()));
  hoareSortSeq->outputs_count.emplace_back(inputArray.size());

  HoareSortSequential hoareSortSequential(hoareSortSeq);
  ASSERT_TRUE(hoareSortSequential.validation());
  hoareSortSequential.pre_processing();
  hoareSortSequential.run();
  hoareSortSequential.post_processing();

  std::vector<int> outputArrayTBB(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortTBB = std::make_shared<ppc::core::TaskData>();
  hoareSortTBB->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortTBB->inputs_count.emplace_back(inputArray.size());
  hoareSortTBB->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArrayTBB.data()));
  hoareSortTBB->outputs_count.emplace_back(inputArray.size());

  auto hoareSortTBBParallel = std::make_shared<HoareSortTBB>(hoareSortTBB);

  auto perfAttr = std::make_shared<ppc::core::PerfAttr>();
  perfAttr->num_running = 10;
  const auto t0 = std::chrono::high_resolution_clock::now();
  perfAttr->current_timer = [&] {
    auto current_time_point = std::chrono::high_resolution_clock::now();
    auto duration = std::chrono::duration_cast<std::chrono::nanoseconds>(current_time_point - t0).count();
    return static_cast<double>(duration) * 1e-9;
  };

  auto perfResults = std::make_shared<ppc::core::PerfResults>();

  auto perfAnalyzer = std::make_shared<ppc::core::Perf>(hoareSortTBBParallel);
  perfAnalyzer->pipeline_run(perfAttr, perfResults);
  ppc::core::Perf::print_perf_statistic(perfResults);
  ASSERT_EQ(outputArraySeq, outputArrayTBB);
}

TEST(kuznetsov_m_hoare_sort_tbb, test_task_run) {
  std::vector<int> inputArray = {
      -4756, -42,   7328,  -3411, 4169,  2421,  2323,  -5363, 7683,  -2768, -1865, -516,  -8424, 258,   1346,  6953,
      4322,  -3019, 5762,  8278,  655,   -3322, 5799,  -4712, -1905, -5911, -6471, 4210,  9761,  7960,  7752,  -98,
      6147,  7809,  8334,  4655,  -7165, -9989, -5900, -8318, 5662,  -919,  -9998, -8282, -2168, 4232,  -5777, -747,
      331,   9658,  -4323, -8318, 4840,  7972,  3501,  4555,  -1040, -9664, -5313, -2760, -4726, -7332, -3659, -1684,
      8787,  -6309, 8797,  641,   -8863, -1879, -2269, -1826, 3196,  2474,  1152,  1531,  4399,  1415,  -2079, -6232,
      9564,  993,   7538,  1321,  472,   3343,  7047,  7349,  3241,  -146,  4164,  5646,  -5249, -4678, 740,   -6467,
      6243,  3545,  9820,  -6181, -9247, 1711,  -1608, -2360, -9584, 1154,  -8552, 9863,  7797,  -2369, 8356,  -6212,
      -3273, -5792, 9378,  -4414, -1744, 3769,  -5264, -8623, -362,  -3431, -7265, 9176,  1063,  -6996, 2018,  -8408,
      965,   8358,  -8470, -6582, -6077, -8849, 3468,  9235,  265,   -4625, -1604, 6347,  -4907, 9974,  6308,  1090,
      1048,  -4251, 2241,  -6473, 2413,  5394,  4198,  9942,  -7987, 6743,  -7297, -5439, 9014,  -9012, 3574,  822,
      -5941, 6353,  4209,  -6883, -2317, 4260,  5663,  -5452, 3127,  2598,  7486,  1839,  -8868, 5288,  -380,  -5081,
      -9326, -4950, 6091,  5947,  -8907, -8460, 50,    -7417, 9909,  -4898, -1910, 9754,  8132,  5709,  7469,  -4151,
      1651,  -267,  7067,  -9844, 4658,  2517,  -287,  7402,  -9905, -2913, -1550, -2131, 6548,  8901,  -5384, 6869,
      -5613, 6277,  -8117, -2810, -9249, -1710, -4881, 1443,  3933,  -6937, -7614, -9716, 9558,  9961,  8116,  -903,
      -1868, -7831, 1261,  -187,  -6215, -5411, 5973,  -4407, -8534, 8669,  -1859, -1923, 2721,  -1816, 8432,  -4676,
      4671,  -8379, 7877,  8453,  -4393, -367,  -7355, 5736,  -3663, -441,  6688,  -8664, 2922,  3051,  -6452, -6417,
      3833,  9007,  3760,  9731,  6460,  -3557, 5591,  -297,  -1202, 6837,  4343,  -2994, 5573,  -2053, -8396, -8281,
      -1282, -2424, -9406, 634,   9156,  3654,  -9096, 8332,  9942,  5033,  2794,  223,   -3263, 6196,  -5488, 8649,
      -1721, -1649, 6938,  -2654, 7840,  -9201, 483,   -7732, 5767,  -3353, -9473, 1543,  5853,  -5641, 8481,  -47,
      7393,  914,   3787,  -8897, 7918,  -4429, -7347, 2015,  6756,  -7557, 4521,  -6008, 6376,  5832,  -735,  -4820,
      -6545, 4907,  -6208, 1971,  -7980, 5995,  -3039, 9668,  6341,  -6551, 7852,  7895,  -9149, 7520,  -4496, -7632,
      -1584, 859,   3787,  -1432, -9091, -8999, -741,  9639,  -3111, 7967,  851,   3071,  7613,  -8878, 539,   -5147,
      5431,  -4612, -6263, 363,   3863,  1248,  -4942, 3163,  595,   -3022, -5661, -7590, 1841,  -1505, 5046,  9915,
      6697,  -3780, 7133,  -3163, -3340, -4580, 3360,  -7465, -2390, 4362,  -2324, -8909, -7679, -6504, -4600, 5656,
      -4820, 6861,  1911,  8298,  6852,  -1747, -2863, -3518, -6582, 1502,  -5315, -8543, 9150,  8438,  -5639, 6945,
      4195,  7846,  5657,  -3164, -6508, 1284,  -8871, -7331, -3513, -8668, 713,   6006,  -1518, -8283, -1005, -9846,
      9842,  7611,  -2120, 6813,  -9530, 3726,  9681,  9000,  3833,  -3139, 3575,  3783,  1342,  7853,  -3880, -5394,
      1966,  -7634, 8387,  -1831, -1178, -3288, -5899, 7047,  -3854, -9917, -7677, 8740,  4010,  785,   -7146, -2848,
      -290,  -6037, 8463,  -6830, -3926, -6791, -6722, -2552, 8343,  6048,  9361,  2966,  6600,  779,   -2781, -2421,
      -3822, -3298, -3131, 2679,  -5126, 9787,  8138,  4284,  9096,  5258,  -730,  3241,  3165,  6782,  420,   -5059,
      -1176, 4219,  8699,  -4511, 5975,  -7358, 172,   -8510, -9283, 2252,  4440,  849,   6882,  1267,  4641,  5818,
      -2135, -2748, -9580, 9360,  2589,  3367,  -2418, -8067, 3339,  8463,  861,   5501,  3639,  2734,  8847,  7658,
      5771,  5712,  -7187, 8125,  -1852, 7345,  8681,  -7547, -3079, 5552,  8208,  8203,  5481,  -7390, -5703, 9568,
      -8609, -2717, -8347, 5939,  -7474, 8461,  -8782, -8795, 3428,  793,   6973,  -138,  -6557, -8966, -3920, -5496,
      -898,  -127,  -8404, 1335,  -1194, -9396, 6020,  4734,  -7299, 3390,  2071,  9631,  -6194, -1678, -4437, 7695,
      314,   5847,  -7893, -6091, 4864,  9566,  -2358, -2968, -3383, 9326,  -9097, -1124, 7636,  3106,  -20,   -7967,
      -5100, -5505, -2397, -6121, 3717,  7128,  -1307, 683,   -4937, -2550, 9816,  -5118, -286,  -9539, -1407, -9558,
      6357,  3409,  -2169, 6659,  -1779, 19,    -7020, -5359, 2554,  -2596, -9085, -5204, 3827,  9878,  -9170, -6504,
      -5170, 8247,  5439,  4324,  3330,  -1602, -4184, -3032, 6780,  -3587, 3332,  -9191, 589,   -2637, 2647,  -9427,
      3849,  -2237, 223,   -4170, 8690,  -8186, -3164, -521,  6070,  -5244, 3563,  3190,  -843,  -4419, -4282, -1605,
      1312,  -1997, 2904,  838,   4572,  7815,  3170,  3553,  920,   5657,  -2497, 1477,  4314,  2086,  -1406, -7919,
      4380,  4536,  5111,  -7506, 4724,  6412,  8567,  -1894, 3613,  -5265, -8821, -2510, 6983,  -2942, 5914,  -1236,
      8026,  5718,  7986,  5110,  9716,  5629,  -2995, -9211, -7898, -2005, 1994,  -8170, 4057,  -8938, -813,  2681,
      7778,  152,   3300,  8484,  -7179, 7394,  365,   -6434, -8160, 6903,  9153,  6365,  -3367, -5036, -730,  2797,
      6147,  -5660, -3937, -8644, 8807,  7422,  -5614, 9775,  -3844, -5175, -7097, 7401,  126,   5247,  -7868, 4022,
      -982,  -5585, 8096,  2251,  -372,  -9182, 9329,  -4544, 195,   6260,  5268,  -4423, 8185,  1527,  5552,  8915,
      365,   9712,  -8069, 3313,  -2785, -6184, -5749, -6613, 3342,  3250,  1875,  1644,  -7900, -4868, 6052,  5979,
      -3900, -3283, -6262, -8379, -67,   1676,  -1407, 8671,  -8087, 4280,  5121,  -6969, 17,    2069,  -8345, -7287,
      6895,  -23,   4389,  -8207, 9235,  4942,  -2530, -3385, 7010,  -9105, 3924,  -2808, -4818, 8677,  -2574, 1734,
      -6417, -2357, 4581,  2707,  -7377, 2960,  -3595, -8221, 1595,  7373,  3318,  -2396, -6713, 9070,  5889,  -2848,
      1978,  -8624, 3595,  -7052, -3655, -9857, 7885,  -330,  7387,  359,   3576,  -6316, -4422, -6976, -9739, 176,
      -9938, -1470, 4500,  8746,  3228,  3044,  -8035, 8430,  -5502, 8335,  8783,  -5960, 2405,  -2756, -1408, 3779,
      -9047, -7216, 9397,  -591,  -1709, -7049, 9973,  -65,   -310,  4858,  -7640, -1900, -9539, 1663,  -1223, -8142,
      3875,  3461,  -1373, -9670, 5214,  1496,  3707,  9274,  -592,  2387,  -7648, 5449,  8216,  9718,  -4198, -1499,
      4385,  -7512, 124,   -8599, 7531,  5698,  -1858, 4845,  -9991, -4766, 2838,  99,    -5991, 616,   9276,  5335,
      9451,  -7601, -3224, 4286,  -4379, -3044, 5778,  -3018, -1547, 8031,  2914,  6030,  -3979, 2286,  -1741, -2011,
      -2150, 4941,  -2162, -7661, -7349, -629,  6465,  6244,  -7752, 583,   -8355, 4201,  -5141, -4476, -3455, -7424,
      -1743, 2100,  -8898, -8964, -964,  4187,  -7065, 3741,  -3263, 1045,  -1011, -6751, -6828, 242,   8945,  2322,
      3882,  5593,  3304,  -5872, -5662, 2038,  6562,  7281,  -8285, 1127,  7115,  -6480, 9947,  -8323, 3021,  6980,
      1384,  3875,  6024,  -2261, -7389, -2937, 1996,  -6542, -5190, -1203, -4711, -2295, 6662,  9263,  -1047, -6697,
      2461,  -3927, -7540, 4571,  10,    9372,  -8916, 5778,  1654,  6083,  3833,  8614,  3539,  7379,  -1996, 4219,
      7039,  -5838, -1578, -7904, -2280, 8010,  4769,  7819,  -8207, 5384,  -1100, 2448,  -8966, 4741,  -8965, -514,
      5711,  -758,  2706,  -5043, -3510, -1463, 3628,  3145,  2194,  -3752, 1188,  -1227, -1597, -3182, -9544, -7268,
      3773,  8333,  6708,  2631,  3754,  -8241, -9957, 1465,  -6042, 4327,  3131,  -7894, -1690, -7327, 1625,  -7729,
      -3960, -7482, 8265,  5418,  3348,  3298,  8721,  5748,  -3006, 2295,  3793,  -4641, 1525,  -856,  1642,  -4737,
      -9990, -4111, 1214,  7766,  -9152, 4598,  6527,  7548,  7112,  5086,  -7810, -6562, 1736,  -7227, 5055,  2738,
      -8352, 8641,  -5066, -3933, 533,   -1987, -7044, 8560,  -9170, 7921,  301,   -9043, 9224,  8298,  2102,  6306,
      442,   8238,  -760,  -5476, -6962, -4615, 8455,  -9484, -7325, -5011, 944,   -6828, 3773,  -622,  8479,  -1989,
      -6315, 5623,  -4655, 3226,  6666,  9864,  7046,  7879,  3057,  8039,  8873,  4080,  932,   -1723, 455,   1665,
      -4194, -3558, 6739,  -4744, -9322, -9265, -1335, 6335,  -3421, -4779, -8497, -7070, 587,   -9420, 5336,  -4462,
      7680,  -6978, 5854,  1361,  -7156, -9482, 9222,  -9040, 703,   7947,  304,   -3729, 4759,  7971,  1225,  9606,
      -2462, 1065,  -467,  2477,  -6585, -9175, 2129,  1926,  6358,  -6261, -7636, 8323,  3386,  -7322, -9502, -3523,
      7450,  -9292, -1163, 6430,  -3220, -647,  4419,  -1380, -3283, -4602, -471,  7608,  3667,  5189,  -756,  -9102,
      -8911, -3150, -1060, -3572, -5615, 4286,  2668,  4049,  -53,   8630,  -8670, 1450,  -2835, 5171,  -3316, 8896,
      9076,  -2190, 5281,  -9026, -170,  7372,  5085,  7934,  -9086, -2124, 5857,  -4848, 3537,  5654,  -3805, -1782,
      5578,  1999,  3243,  5224,  -766,  5498,  -5765, 4181,  -5280, 8715,  -3704, 8157,  -9356, -6461, -7613, -3273,
      -4076, -4060, 2090,  4932,  8619,  9808,  8100,  1169,  -6236, -1320, 6062,  -2625, 7072,  9076,  5274,  -4452,
      -6428, -9309, 4668,  -4641, 3817,  5210,  -4498, 9629,  7456,  -3624, -6603, -8542, 5209,  -4348, 163,   2457,
      -8058, 1816,  -9066, 5299,  2195,  -6646, -2173, 1513,  -2314, -4205, 2558,  9022,  -3555, 6720,  -986,  1930,
      -643,  8450,  -1439, -5509, -3505, 1799,  6391,  6542,  5993,  -389,  -9115, 90,    -184,  -8841, -1275, -316,
      -20,   -4002, 5158,  -5205, -7179, -8970, -837,  3905,  1024,  3918,  9548,  -2746, 8724,  698,   -1565, 6146,
      9000,  903,   9883,  9132,  -7298, -9681, -6130, -8607, 2311,  -283,  -8250, -8345, -4742, -9487, -382,  8848,
      3762,  -2364, 8562,  9942,  478,   -4441, -4930, -3545, 4490,  8558,  8162,  -2583, 4339,  4213,  4264,  1068,
      8783,  4659,  -3513, -4931, 6803,  2059,  -5353, 1577,  4331,  1974,  6970,  1669,  4902,  -6686, -8757, -2916,
      8331,  8030,  788,   -8711, 5497,  -6190, -1663, -1709, -6938, -6765, 1073,  -5602, -8046, 8810,  -4982, 8723,
      -8803, -8956, 4375,  5400,  1103,  5068,  5889,  4806,  8212,  -3013, -1415, 3313,  -73,   -1545, 7743,  -6256,
      9524,  -8109, -6955, -5971, -3904, 8444,  -6987, -7358, -8564, 1412,  6377,  6283,  -413,  -7270, -9587, 1593,
      4762,  3696,  -4837, 9464,  -1643, -7916, -5582, -954,  240,   -2593, 4652,  9057,  -3837, -5301, -9560, -9552,
      -5607, 8289,  1614,  -7783, 6143,  -195,  -5751, -1995, -1522, -7852, 7213,  9331,  -7408, 5058,  2113,  7289,
      9612,  6406,  4304,  -9352, 2556,  -329,  -1173, 8809,  4596,  1601,  -5329, 3801,  4556,  3795,  7385,  -1051,
      -8745, -5332, -1189, -1228, 3223,  9616,  373,   -662,  2802,  -7570, 519,   -5080, 1991,  2521,  9559,  3641,
      -1286, 3462,  -2371, -7764, -2978, -4271, 2212,  5755,  666,   -7445, -8216, -784,  5182,  -161,  3270,  3961,
      -416,  -1534, -3127, -9487, -3671, 2533,  -8670, -7029, -3296, 11,    1218,  5243,  -2728, 3555,  6264,  8470,
      -9610, -7779, 4241,  2631,  -285,  -1031, -1081, 2545,  -7153, 3164,  8722,  -1113, 3859,  9469,  4916,  -4256,
      6339,  9519,  -5910, 141,   -9871, 3591,  -3370, -1238, 5291,  -3761, 4046,  3669,  589,   -6932, 1889,  -3379,
      1619,  4915,  9970,  -3013, 2516,  2997,  -8211, 6339,  5665,  2291,  7366,  -7930, -984,  6333,  204,   -9298,
      3596,  2892,  8910,  4424,  8349,  8616,  6696,  5615,  -9953, 258,   -5685, -2660, -6523, 413,   -7889, 9746,
      5946,  -7545, 8107,  -9387, -1942, 3516,  -9451, 9192,  -6168, -2832, 7843,  -4288, 1768,  1716,  6797,  -6704,
      -8775, 5496,  -8501, -1369, 2823,  -3177, -3691, 7045,  7830,  -5107, -5403, 7522,  -7181, -1672, 7624,  -9591,
      8070,  -9746, 2201,  -934,  -1267, -7384, 6264,  -6779, -1549, 597,   -2862, -9648, -1659, -1201, 7715,  3276,
      -412,  -4807, 6151,  2357,  -8074, 5524,  -6835, 846,   -7561, -1605, -7906, -4487, -9920, -6483, 1278,  -5416,
      -8585, -9762, -6531, -3425, -6438, -7227, 6018,  8955,  -9134, 8204,  5533,  1378,  8562,  5539,  5547,  -4506,
      -36,   7297,  5417,  8660,  4454,  -6327, 45,    1291,  -8937, -6104, 6417,  6364,  6925,  7224,  -5716, -7157,
      3930,  -796,  -3366, -8135, -4586, -6527, -5496, 8454,  -3013, 398,   5207,  -9209, -140,  -3823, -6627, 6229,
      -1365, -8810, 3466,  4450,  8486,  -8254, 8683,  -3962, 1457,  2672,  -189,  151,   4050,  5228,  -7162, -749,
      -3652, 546,   3251,  -4368, 4043,  -2690, 466,   -9219, 8237,  8454,  -6688, -3565, 9684,  -4122, 1136,  3600,
      6059,  -4041, -3103, -2275, 3201,  9572,  653,   994,   -970,  6913,  3548,  2163,  7962,  3779,  -6318, 9627,
      353,   859,   4515,  -1853, 5918,  9960,  1730,  5694,  -4126, 7725,  4197,  8713,  -2289, -8416, -4857, -4011,
      874,   -4462, -2195, -2905, 7821,  6136,  -7732, -5798, -1167, 1077,  968,   4176,  -5634, -9073, 8361,  -450,
      -8822, 8068,  -6123, 4999,  991,   7319,  -3369, -9744, 6835,  2545,  -5531, 3798,  2895,  5844,  -3516, 1597,
      1486,  -1269, 4431,  -4084, -236,  7800,  6398,  -7564, -9507, 5507,  -7572, 4957,  -8404, 2581,  8871,  -3459,
      -8725, 2885,  4812,  -4365, 9729,  -2090, -9691, 7941,  3928,  -7622, 1023,  -2011, -6894, -9884, -6100, -274,
      3581,  9253,  -4726, -8490, -6044, -7306, 9306,  9001,  -3528, -8302, -2018, -2729, 3532,  1722,  -9230, -3820,
      1259,  -3932, 8278,  -2238, 3290,  -9003, 3654,  2905,  517,   1250,  6565,  -7167, 8869,  -681,  -2442, 9370,
      5274,  928,   -6570, -1282, -1617, 5737,  8237,  -2629, 9332,  -1983, -7075, 162,   4860,  222,   -2115, -7117,
      875,   -3086, -9767, -4428, -6797, 5761,  -8650, -5276, -2417, -4668, 7275,  23,    -5245, -9375, 1833,  6541,
      -1734, -4001, -8558, -4844, -9926, 6570,  -1941, 9289,  2072,  3139,  -7538, 5031,  -6010, 5272,  8329,  9878,
      -7646, -2319, 2699,  -1869, 4378,  1427,  9174,  -403,  712,   3580,  -9050, 6991,  8391,  9934,  4413,  -9736,
      -7260, 22,    -4867, -4117, 3491,  -7939, 28,    -5134, -8494, -1352, 2980,  -7947, -4175, -8424, 1994,  -3314,
      5392,  -1785, -2885, -7409, 1601,  8211,  -5096, 3044,  7015,  5558,  8381,  8265,  1353,  3201,  554,   8583,
      6334,  -5859, -9907, -7216, -2628, 939,   9450,  2942,  -9473, 4066,  -466,  -3819, 5902,  8963,  -8690, -4139,
      -7383, -7226, 7798,  -4113, -3842, 3776,  -7027, 4303,  5721,  -6695, -9800, -5740, -5477, -951,  -1638, -598,
      -8845, 7365,  -6463, -6239, 8100,  -6699, -8658, -8802, -1196, -3719, 5080,  7500,  -5888, -1279, -7006, -8222,
      -2597, -8312, 5341,  8434,  -2810, -9281, 5387,  -6295, 4281,  -5894, -9604, 5618,  8819,  7792,  -5332, 9700,
      951,   8982,  -6952, -7960, -5406, -6128, 9191,  -9351, 3592,  -6319, -9747, 3515,  -8884, -5066, -3069, 8350};

  std::vector<int> outputArraySeq(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortSeq = std::make_shared<ppc::core::TaskData>();
  hoareSortSeq->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortSeq->inputs_count.emplace_back(inputArray.size());
  hoareSortSeq->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArraySeq.data()));
  hoareSortSeq->outputs_count.emplace_back(inputArray.size());

  HoareSortSequential hoareSortSequential(hoareSortSeq);
  ASSERT_TRUE(hoareSortSequential.validation());
  hoareSortSequential.pre_processing();
  hoareSortSequential.run();
  hoareSortSequential.post_processing();

  std::vector<int> outputArrayTBB(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortTBB = std::make_shared<ppc::core::TaskData>();
  hoareSortTBB->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortTBB->inputs_count.emplace_back(inputArray.size());
  hoareSortTBB->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArrayTBB.data()));
  hoareSortTBB->outputs_count.emplace_back(inputArray.size());

  auto hoareSortTBBParallel = std::make_shared<HoareSortTBB>(hoareSortTBB);

  auto perfAttr = std::make_shared<ppc::core::PerfAttr>();
  perfAttr->num_running = 10;
  const auto t0 = std::chrono::high_resolution_clock::now();
  perfAttr->current_timer = [&] {
    auto current_time_point = std::chrono::high_resolution_clock::now();
    auto duration = std::chrono::duration_cast<std::chrono::nanoseconds>(current_time_point - t0).count();
    return static_cast<double>(duration) * 1e-9;
  };

  auto perfResults = std::make_shared<ppc::core::PerfResults>();

  auto perfAnalyzer = std::make_shared<ppc::core::Perf>(hoareSortTBBParallel);
  perfAnalyzer->task_run(perfAttr, perfResults);
  ppc::core::Perf::print_perf_statistic(perfResults);
  ASSERT_EQ(outputArraySeq, outputArrayTBB);
}